<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Maze Runner VR</title>
    <meta name="description" content="Multiplayer VR Maze Runner Game" />

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-component/dist/aframe-animation-component.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>

    <link rel="stylesheet" href="./css/style.css" />
    
    <script src="./js/config/config.js"></script>
    <script src="./js/utils/utils.js"></script>
    <script src="./js/utils/debug-utils.js"></script>
    <script src="./js/utils/coordinate-utils.js"></script>
    <script src="./js/utils/collision-utils.js"></script>
    <script src="./js/core/game-state.js"></script>
    <script src="./js/network/ws-client.js"></script>
    <script src="./js/network/ws-handlers.js"></script>
    <script src="./js/controllers/movement-controller.js"></script>
    <script src="./js/controllers/input-controller.js"></script>
    <script src="./js/controllers/camera-controller.js"></script>
    <script src="./js/managers/ui-manager.js"></script>
    <script src="./js/managers/maze-manager.js"></script>
    <script src="./js/managers/player-manager.js"></script>
    <script src="./js/managers/treasure-manager.js"></script>
    <script src="./js/managers/spectator-manager.js"></script>
    <script src="./js/controllers/game-controller.js"></script>
    <script src="./js/main.js" defer></script>
  </head>
  <body>
    <div id="connectionStatus" class="status-connecting">Conectando...</div>

    <div id="lobby">
      <div class="lobby-content">
        <h1>Maze Runner VR</h1>

        <!-- Name Entry Screen -->
        <div id="nameScreen">
          <p class="subtitle">Insira seu nome para come√ßar</p>
          <input type="text" id="playerNameInput" placeholder="Seu nome" maxlength="20" />
          <button id="continueBtn">Continuar</button>
        </div>

        <!-- Room Selection Screen -->
        <div id="lobbyScreen" style="display: none">
          <p class="subtitle">Escolha uma op√ß√£o:</p>
          <button id="showRoomsBtn" class="primary-btn">Ver Salas Dispon√≠veis</button>
          <button id="createBtn" class="primary-btn">Criar Nova Sala</button>
        </div>

        <!-- Rooms List Screen -->
        <div id="roomsListScreen" style="display: none">
          <h2>Salas Dispon√≠veis</h2>
          <p class="subtitle">Selecione uma sala para entrar</p>

          <!-- Spectator Checkbox - BEFORE joining -->
          <div id="spectatorOption" class="spectator-option">
            <label class="spectator-label">
              <input type="checkbox" id="spectatorCheckbox" />
              <span class="spectator-checkmark"></span>
              <span class="spectator-text">üëÅÔ∏è Entrar como Espectador (Drone)</span>
            </label>
            <p class="spectator-info">
              Espectadores assistem de cima e <strong>n√£o contam como jogadores</strong>.
            </p>
          </div>

          <div id="roomsListContainer">
            <div id="loadingRooms" class="loading-message">Carregando salas...</div>
            <div id="noRoomsMessage" class="no-rooms-message" style="display: none">
              Nenhuma sala dispon√≠vel.<br><br>Crie uma nova sala!
            </div>
            <div id="roomsList" class="rooms-list"></div>
          </div>

          <div class="rooms-actions">
            <button id="refreshRoomsBtn" class="secondary-btn">üîÑ Atualizar</button>
            <button id="backToLobbyBtn" class="secondary-btn">‚Üê Voltar</button>
          </div>
        </div>

        <!-- Waiting Room Screen -->
        <div id="waitingScreen" style="display: none">
          <h2 class="waiting-title">Esperando jogadores...</h2>
          <p id="currentRoom" class="room-code"></p>
          
          <!-- Spectator Status Banner -->
          <div id="spectatorStatusBanner" class="spectator-status-banner" style="display: none;">
            üëÅÔ∏è Voc√™ est√° como <strong>ESPECTADOR</strong>
            <br><small>Voc√™ n√£o ser√° contado como jogador</small>
          </div>
          
          <div id="playerList"></div>
          <p class="player-info">Min 2 jogadores ‚Ä¢ Max 4 jogadores</p>
          <button id="readyBtn">Pronto</button>
          <button id="leaveBtn" class="leave-btn">Sair da sala</button>
        </div>
      </div>
    </div>

    <div id="countdown"></div>

    <div id="hud">
      <div>Jogador: <span id="playerName"></span></div>
      <div>Tesouros: <span id="treasureCount"></span></div>
      <div>Tempo: <span id="timer">0:00</span></div>
    </div>

    <div id="leaderboard">
      <h3>Ranking</h3>
      <div id="leaderboardList"></div>
    </div>

    <div id="controls-info">
      <strong>Controles:</strong><br />
      W = Frente | S = Tr√°s | A = Esquerda | D = Direita<br />
      <small>üñ±Ô∏è Mova o mouse para olhar | Clique para travar cursor | ESC para destravar</small>
    </div>

    <a-scene id="scene" background="color: #87CEEB">
      <a-assets>
        <img id="grass-texture" src="./assets/img/floor-dark.jpg" crossorigin="anonymous" />
        <img id="wall-texture" src="./assets/img/brick-p.png" crossorigin="anonymous" />
        <img id="sky-texture" src="./assets/img/sky.jpg" crossorigin="anonymous" />
        <audio id="footstep-sound" src="./assets/sounds/footstep.mp3" preload="auto"></audio>
        <audio id="collect-sound" src="./assets/sounds/collect.mp3" preload="auto"></audio>
        <audio id="ambient-sound" src="./assets/sounds/ambient.mp3" preload="auto"></audio>
        <audio id="win-sound" src="./assets/sounds/victory.mp3" preload="auto"></audio>
      </a-assets>

      <a-entity id="rig" position="0 1 0">
        <a-camera id="player-camera" look-controls="pointerLockEnabled: true; reverseMouseDrag: false" wasd-controls="enabled: false">
          <a-entity cursor="fuse: true; fuseTimeout: 750" position="0 0 -1"
            geometry="primitive: ring; radiusInner: 0.015; radiusOuter: 0.025"
            material="color: #40E0D0; shader: flat; transparent: true; opacity: 0.9"
            raycaster="objects: .clickable, .treasure; far: 25; interval: 100">
          </a-entity>
        </a-camera>
      </a-entity>

      <a-sound src="#ambient-sound" autoplay="true" loop="true" volume="0.3" position="0 1.6 0"></a-sound>
      <a-sky src="#sky-texture" rotation="0 90 0"></a-sky>
      <a-plane id="ground" position="0 0 0" rotation="-90 0 0" width="150" height="150" src="#grass-texture" repeat="20 20" shadow="receive: true"></a-plane>
      <a-light type="ambient" color="#BBB" intensity="0.6"></a-light>
      <a-light type="directional" color="#FFF" intensity="0.8" position="5 10 7" castShadow="true"></a-light>
      <a-light type="point" position="0 5 0" color="#FFF" intensity="0.4"></a-light>
      <a-entity id="maze"></a-entity>
      <a-entity id="players"></a-entity>
      <a-entity id="treasures"></a-entity>
    </a-scene>
  </body>
</html>